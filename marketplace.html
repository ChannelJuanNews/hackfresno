<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> KarmaApp - Marketplace</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <!-- Bulma Version 0.6.2-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css" integrity="sha256-2k1KVsNPRXxZOsXQ8aqcZ9GOOwmJTMoOB5o5Qp1d6/s=" crossorigin="anonymous" />
  <style type="text/css">
    html,body {
      font-family: 'Open Sans';
    }
  </style>
</head>
    <body>

        <section class="hero is-fullheight is-default is-bold">
        <div class="hero-head">
          <nav class="navbar">
            <div class="container">
              <div class="navbar-brand">
                <a class="navbar-item" href="../">
                  <h1>KarmaApp</h1>
                </a>
                <span class="navbar-burger burger" data-target="navbarMenu">
                  <span></span>
                  <span></span>
                  <span></span>
                </span>
              </div>
              <div id="navbarMenu" class="navbar-menu">
       <div class="navbar-end"><div class="tabs is-right">
        <ul>
          <li ><a href="/">Home</a></li>
          <li class="is-active" ><a href="/marketplace">Marketplace</a></li>
          <li><a id="username-top" href="#"></a></li>
          <li><span class="tag is-success" id="tag-karma"></span></li>
        </ul>
      </div>
                </div>
              </div>
            </div>
          </nav>
        </div>


    <div class="hero-body">

        <div class="container">
            <div class="column is-12">


                <h1 class="title has-text-centered">Spend Your Karma</h1>

                <section class="info-tiles has-text-centered">
                  <div class="tile is-ancestor has-text-centered">
                    <div class="tile is-parent">
                      <article class="tile is-child box" id="massage">
                        <p class="title">43</p>
                        <p class="subtitle">Massage</p>
                      </article>
                    </div>
                    <div class="tile is-parent">
                      <article class="tile is-child box" id="hug">
                        <p class="title">59</p>
                        <p class="subtitle">Hug</p>
                      </article>
                    </div>
                    <div class="tile is-parent">
                      <article class="tile is-child box" id="backrub">
                        <p class="title">100</p>
                        <p class="subtitle">Back Rub</p>
                      </article>
                    </div>
                    <div class="tile is-parent">
                      <article class="tile is-child box" id="cookies">
                        <p class="title">19</p>
                        <p class="subtitle">Cookies</p>
                      </article>
                    </div>
                  </div>
                </section>


                <section class="info-tiles has-text-centered">
                  <div class="tile is-ancestor has-text-centered">
                    <div class="tile is-parent">
                      <article class="tile is-child box" id="hackathonwin">
                        <p class="title">1000</p>
                        <p class="subtitle">Hackathon Win</p>
                      </article>
                    </div>
                    <div class="tile is-parent">
                      <article class="tile is-child box" id="hackfresnotshirt">
                        <p class="title">35</p>
                        <p class="subtitle">Hack Fresno <br /> T-Shirt</p>
                      </article>
                    </div>
                    <div class="tile is-parent">
                      <article class="tile is-child box" id="googlecloudapicredits">
                        <p class="title">34</p>
                        <p class="subtitle">Google Clould API Credits</p>
                      </article>
                    </div>
                    <div class="tile is-parent">
                      <article class="tile is-child box" id="redbull">
                        <p class="title">19</p>
                        <p class="subtitle">Red Bull</p>
                      </article>
                    </div>
                  </div>
                </section>



                <section class="info-tiles has-text-centered">
                  <div class="tile is-ancestor has-text-centered">
                    <div class="tile is-parent">
                      <article class="tile is-child box" id="boba">
                        <p class="title">43</p>
                        <p class="subtitle">Boba</p>
                      </article>
                    </div>
                    <div class="tile is-parent">
                      <article class="tile is-child box" id="popcornchicken">
                        <p class="title">74</p>
                        <p class="subtitle">Popcorn Chicken</p>
                      </article>
                    </div>
                    <div class="tile is-parent">
                      <article class="tile is-child box" id="stickers">
                        <p class="title">5</p>
                        <p class="subtitle">Stickers</p>
                      </article>
                    </div>
                    <div class="tile is-parent">
                      <article class="tile is-child box" id="changethemusic">
                        <p class="title">9</p>
                        <p class="subtitle"> Change The Music </p>
                      </article>
                    </div>
                  </div>
                </section>

                <section class="info-tiles has-text-centered">
                  <div class="tile is-ancestor has-text-centered">
                    <div class="tile is-parent">
                      <article class="tile is-child box" id="water">
                        <p class="title">4</p>
                        <p class="subtitle">Water</p>
                      </article>
                    </div>
                    <div class="tile is-parent">
                      <article class="tile is-child box" id="oranges">
                        <p class="title">7</p>
                        <p class="subtitle">Oranges</p>
                      </article>
                    </div>
                    <div class="tile is-parent">
                      <article class="tile is-child box" id="coffee">
                        <p class="title"> 3 </p>
                        <p class="subtitle"> Coffee </p>
                      </article>
                    </div>
                    <div class="tile is-parent">
                      <article class="tile is-child box" id="internship">
                        <p class="title">999</p>
                        <p class="subtitle">Internship</p>
                      </article>
                    </div>
                  </div>
                </section>



            </div>
                <br />
                <br />
                <br />
                <br />
                <br />
        </div>

    </div>
    </section>


    <style media="screen">
        .box:hover{
             background-color: #00E5EE;
        }
    </style>


    <script type="text/javascript">
        window.onload = function(){
            storage = window.localStorage;
            let username = storage.getItem('username')
            let tabusername = document.getElementById("username-top")
            tabusername.innerHTML = username


            let currentkarma = document.getElementById('tag-karma')

            function getOwnKarma(){
                fetch('/ownkarma', {
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    method: 'post',
                    body : JSON.stringify({
                        username    : storage.getItem('username')
                    })

                }).then(function(response){
                    return response.json()
                }).then(function(data){
                    // handle data here
                    console.log(data)
                    currentkarma.innerHTML = Number(data.karma).toFixed(2)
                })
            }

            function spendKarma(amt){

                if ( !((currentkarma.innerHTML - amt) >= 0) ){
                    return alert('Not enough funds')
                }


                let con = confirm("Are you sure you want to spend " + amt + " karma?")
                console.log(con)
                if (!con){
                    return
                }

                fetch('/spendkarma', {
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    method: 'post',
                    body : JSON.stringify({
                        username    : storage.getItem('username'),
                        spent : amt
                    })

                }).then(function(response){
                    return response.json()
                }).then(function(data){
                    // update amount of karma on front end
                    console.log(data)
                    currentkarma.innerHTML = Number(data.karma).toFixed(2)
                })

            }


            $('#massage').click(function(){
                spendKarma(43)
            })
            $('#hug').click(function(){
                spendKarma(59)
            })
            $('#backrub').click(function(){
                spendKarma(100)
            })
            $('#cookies').click(function(){
                spendKarma(19)
            })
            $('#hackathonwin').click(function(){
                spendKarma(1000)
            })
            $('#hackfresnotshirt').click(function(){
                spendKarma(35)
            })
            $('#googlecloudapicredits').click(function(){
                spendKarma(34)
            })
            $('#redbull').click(function(){
                spendKarma(19)
            })
            $('#boba').click(function(){
                spendKarma(43)
            })
            $('#popcornchicken').click(function(){
                spendKarma(74)
            })
            $('#stickers').click(function(){
                spendKarma(5)
            })
            $('#changethemusic').click(function(){
                spendKarma(9)
            })
            $('#water').click(function(){
                spendKarma(4)
            })
            $('#oranges').click(function(){
                spendKarma(7)
            })
            $('#coffee').click(function(){
                spendKarma(3)
            })
            $('#internship').click(function(){
                spendKarma(999)
            })


            getOwnKarma()

            var burger = document.querySelector('.burger');
            var menu = document.querySelector('#'+burger.dataset.target);
            burger.addEventListener('click', function() {
                burger.classList.toggle('is-active');
                menu.classList.toggle('is-active');
            })



        }
    </script>



    </body>
</html>
